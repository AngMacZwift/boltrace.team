<html>
	<head>
		<meta charset="utf-8"/>
		<link href="/assets/css/d3-geomap.css" rel="stylesheet"/>
		<style type='text/css'>
		</style>
	</head>
	<body>
		<svg xmlns="http://www.w3.org/2000/svg" style="display:none" viewBox="0 0 461.9 465.3" y="0px" x="0px">
			<defs>
				<symbol id="pinMen" viewBox="0 0 461.9 465.3">
					<style
   id="style1067"
   type="text/css">
	.st0{fill:#A7A6A6;}
	.st1{fill:#D288BA;}
	.st2{fill:#C16EA9;}
</style>
<title
   id="title1069">Men Pin</title>
<g
   style="stroke:#000000;stroke-width:8;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
   id="g1086">
	<path
   class="st0"
   d="m 162.1,420.8 11.7,-45.7 C 94.4,343.3 55.9,253.1 87.7,173.8 107.8,123.6 152.6,87.6 205.9,78.7 l 34.4,-49.8 c -3.1,1 -6.4,1.4 -9.7,1.4 v 0 C 213.5,30.3 199.2,17.1 198,0 c -8.7,1.2 -17.2,2.9 -25.7,5.1 5.5,16.2 -2.6,33.9 -18.4,40.5 -4,1.7 -8.2,2.5 -12.5,2.5 -12.3,0 -23.6,-7 -29.2,-18 -7.5,4.5 -14.8,9.3 -21.8,14.6 11.9,13.6 10.6,34.3 -2.9,46.2 -12.3,10.8 -30.7,10.9 -43.1,0 -5.2,7 -10.1,14.3 -14.5,21.8 16.1,8 22.7,27.6 14.7,43.7 C 37.4,171 20.4,178 5,172.8 c -2.1,8.4 -3.8,17 -5,25.6 17.1,1.1 30.4,15.3 30.4,32.5 0,17.1 -13.3,31.3 -30.4,32.5 1.2,8.7 2.9,17.4 5.1,26 17.1,-5.7 35.6,3.5 41.3,20.6 5.2,15.4 -1.8,32.3 -16.3,39.6 4.5,7.6 9.4,14.8 14.7,21.8 13.7,-11.7 34.2,-10.2 46,3.5 10.5,12.2 10.5,30.2 0,42.5 7,5.3 14.3,10.1 21.8,14.5 8.1,-16.1 27.7,-22.6 43.8,-14.6 2,1 3.9,2.2 5.7,3.5 z"
   id="path1071"
   style="fill:#a7a6a6;stroke:#000000;stroke-width:8;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /><path
   class="st0"
   d="m 431.6,230.9 v -0.4 c -0.1,-17.1 13.1,-31.4 30.2,-32.6 -1.2,-8.7 -3,-17.2 -5.2,-25.7 -17.1,5.7 -35.6,-3.5 -41.3,-20.6 -5.1,-15.4 1.8,-32.2 16.2,-39.5 -4.5,-7.5 -9.3,-14.8 -14.6,-21.8 -13.5,11.9 -34.1,10.6 -46.1,-2.9 -10.9,-12.3 -10.9,-30.8 -0.1,-43.1 -7,-5.2 -14.3,-10.1 -21.9,-14.5 -5.5,11.1 -16.8,18.1 -29.2,18.1 -4.1,0 -8.2,-0.8 -12,-2.3 l -12.2,44.8 c 77.8,35.5 112.1,127.4 76.6,205.2 -19.4,42.6 -57.1,74.1 -102.4,85.7 L 235,431.7 c 15.5,1.9 27.5,14.5 28.6,30.1 8.7,-1.2 17.2,-2.9 25.7,-5.1 -5.8,-17.1 3.4,-35.6 20.5,-41.4 15.5,-5.2 32.4,1.8 39.7,16.4 7.5,-4.4 14.8,-9.3 21.8,-14.6 -11.8,-13.6 -10.3,-34.2 3.3,-46 12.3,-10.6 30.4,-10.6 42.7,0 5.3,-7 10.1,-14.3 14.6,-21.8 -16.1,-8 -22.7,-27.6 -14.7,-43.8 7.3,-14.6 24.2,-21.6 39.6,-16.4 2.2,-8.5 3.9,-17.1 5.1,-25.7 -17.1,-1.2 -30.3,-15.4 -30.3,-32.5 z"
   id="path1073"
   style="fill:#a7a6a6;stroke:#000000;stroke-width:8;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1" /><polygon
   style="fill:#94431b;fill-opacity:1;stroke:#000000;stroke-width:8;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
   id="polygon1075"
   points="219.9,257.4 242.7,269.8 197.6,465.3 174.8,452.9 "
   class="st1" /><polygon
   style="fill:#94431b;fill-opacity:1;stroke:#000000;stroke-width:8;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
   id="polygon1077"
   points="247,211.5 224.2,199.1 333.5,183.8 356.3,196.2 "
   class="st1" /><polygon
   style="fill:#94431b;fill-opacity:1;stroke:#000000;stroke-width:8;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
   id="polygon1079"
   points="272.3,3.2 295.1,15.6 136.1,284.8 113.3,272.4 "
   class="st1" /><polygon
   style="fill:#d76127;fill-opacity:1;stroke:#000000;stroke-width:8;stroke-linejoin:round;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:1"
   id="polygon1081"
   points="242.7,269.8 136.1,284.8 295.1,15.6 247,211.5 356.3,196.2 197.6,465.3 "
   class="st2" />
</g>
				</symbol>
				<symbol id="pinWomen" viewBox="0 0 461.9 465.3">
					<style
   id="style1068"
   type="text/css">
	.st3{fill:#A7A6A6;}
	.st4{fill:#D288BA;}
	.st5{fill:#C16EA9;}
</style>
<title
   id="title1069">Hellcatz Pin</title>
<g
   style="stroke:#000000;stroke-opacity:1;stroke-width:8;stroke-miterlimit:4;stroke-dasharray:none;stroke-linejoin:round"
   id="g1086">
	<g
   style="stroke:#000000;stroke-opacity:1;stroke-width:8;stroke-miterlimit:4;stroke-dasharray:none;stroke-linejoin:round"
   id="bolt_icon">
		<path
   style="fill:#a7a6a6;stroke:#000000;stroke-opacity:1;stroke-width:8;stroke-miterlimit:4;stroke-dasharray:none;stroke-linejoin:round"
   id="path1071"
   d="m 162.1,420.8 11.7,-45.7 C 94.4,343.3 55.9,253.1 87.7,173.8 107.8,123.6 152.6,87.6 205.9,78.7 l 34.4,-49.8 c -3.1,1 -6.4,1.4 -9.7,1.4 v 0 C 213.5,30.3 199.2,17.1 198,0 c -8.7,1.2 -17.2,2.9 -25.7,5.1 5.5,16.2 -2.6,33.9 -18.4,40.5 -4,1.7 -8.2,2.5 -12.5,2.5 -12.3,0 -23.6,-7 -29.2,-18 -7.5,4.5 -14.8,9.3 -21.8,14.6 11.9,13.6 10.6,34.3 -2.9,46.2 -12.3,10.8 -30.7,10.9 -43.1,0 -5.2,7 -10.1,14.3 -14.5,21.8 16.1,8 22.7,27.6 14.7,43.7 C 37.4,171 20.4,178 5,172.8 c -2.1,8.4 -3.8,17 -5,25.6 17.1,1.1 30.4,15.3 30.4,32.5 0,17.1 -13.3,31.3 -30.4,32.5 1.2,8.7 2.9,17.4 5.1,26 17.1,-5.7 35.6,3.5 41.3,20.6 5.2,15.4 -1.8,32.3 -16.3,39.6 4.5,7.6 9.4,14.8 14.7,21.8 13.7,-11.7 34.2,-10.2 46,3.5 10.5,12.2 10.5,30.2 0,42.5 7,5.3 14.3,10.1 21.8,14.5 8.1,-16.1 27.7,-22.6 43.8,-14.6 2,1 3.9,2.2 5.7,3.5 z"
   class="st3" />
		<path
   style="fill:#a7a6a6;stroke:#000000;stroke-opacity:1;stroke-width:8;stroke-miterlimit:4;stroke-dasharray:none;stroke-linejoin:round"
   id="path1073"
   d="m 431.6,230.9 v -0.4 c -0.1,-17.1 13.1,-31.4 30.2,-32.6 -1.2,-8.7 -3,-17.2 -5.2,-25.7 -17.1,5.7 -35.6,-3.5 -41.3,-20.6 -5.1,-15.4 1.8,-32.2 16.2,-39.5 -4.5,-7.5 -9.3,-14.8 -14.6,-21.8 -13.5,11.9 -34.1,10.6 -46.1,-2.9 -10.9,-12.3 -10.9,-30.8 -0.1,-43.1 -7,-5.2 -14.3,-10.1 -21.9,-14.5 -5.5,11.1 -16.8,18.1 -29.2,18.1 -4.1,0 -8.2,-0.8 -12,-2.3 l -12.2,44.8 c 77.8,35.5 112.1,127.4 76.6,205.2 -19.4,42.6 -57.1,74.1 -102.4,85.7 L 235,431.7 c 15.5,1.9 27.5,14.5 28.6,30.1 8.7,-1.2 17.2,-2.9 25.7,-5.1 -5.8,-17.1 3.4,-35.6 20.5,-41.4 15.5,-5.2 32.4,1.8 39.7,16.4 7.5,-4.4 14.8,-9.3 21.8,-14.6 -11.8,-13.6 -10.3,-34.2 3.3,-46 12.3,-10.6 30.4,-10.6 42.7,0 5.3,-7 10.1,-14.3 14.6,-21.8 -16.1,-8 -22.7,-27.6 -14.7,-43.8 7.3,-14.6 24.2,-21.6 39.6,-16.4 2.2,-8.5 3.9,-17.1 5.1,-25.7 -17.1,-1.2 -30.3,-15.4 -30.3,-32.5 z"
   class="st3" />
		<g
   style="stroke:#000000;stroke-opacity:1;stroke-width:8;stroke-miterlimit:4;stroke-dasharray:none;stroke-linejoin:round"
   id="g1083">
			<polygon
   style="fill:#d288ba;stroke:#000000;stroke-opacity:1;stroke-width:8;stroke-miterlimit:4;stroke-dasharray:none;stroke-linejoin:round"
   id="polygon1075"
   points="197.6,465.3 174.8,452.9 219.9,257.4 242.7,269.8 "
   class="st4" />
			<polygon
   style="fill:#d288ba;stroke:#000000;stroke-opacity:1;stroke-width:8;stroke-miterlimit:4;stroke-dasharray:none;stroke-linejoin:round"
   id="polygon1077"
   points="247,211.5 224.2,199.1 333.5,183.8 356.3,196.2 "
   class="st4" />
			<polygon
   style="fill:#d288ba;stroke:#000000;stroke-opacity:1;stroke-width:8;stroke-miterlimit:4;stroke-dasharray:none;stroke-linejoin:round"
   id="polygon1079"
   points="136.1,284.8 113.3,272.4 272.3,3.2 295.1,15.6 "
   class="st4" />
			<polygon
   style="fill:#c16ea9;stroke:#000000;stroke-opacity:1;stroke-width:8;stroke-miterlimit:4;stroke-dasharray:none;stroke-linejoin:round"
   id="polygon1081"
   points="242.7,269.8 136.1,284.8 295.1,15.6 247,211.5 356.3,196.2 197.6,465.3 "
   class="st5" />
		</g>
	</g>
</g>
				</symbol>
			</defs>
		</svg>
		<div class='d3-geomap' id='map'></div>
	</body>
	<script src='//unpkg.com/d3@5/dist/d3.min.js'></script>
	<script src='//unpkg.com/topojson@3/dist/topojson.min.js'></script>
	<script src='/assets/scripts/d3-geomap.min.js'></script>
	<script src='https://d3js.org/d3-geo-projection.v2.min.js'></script>
	<script
	src="https://code.jquery.com/jquery-3.5.1.min.js"
	integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
	crossorigin="anonymous"></script>
	<script>
		const w = 3000;
		const h = 1250;

		var jsonLocationData = null;

		var countryLocations = null;

		var format = function(d) {
			d = d;
			return d3.format(',.2r')(d) + ' members';
		}

		var map = d3.choropleth()
			.geofile('/assets/scripts/topojson/world/countries.json')
			.colors(d3.quantize(d3.interpolateRgb('rgb(63, 50, 47)', 'rgb(255, 234, 217)'), 9))
			.column('logTotal')
			.unitId('iso3');
		
		d3.json('https://portal.boltrace.team/members/location-data').then(data => {
			console.log(data);
			var selection = d3.select('#map').datum(data);
			map.draw(selection);

			setTimeout(function() { d3.json('https://portal.boltrace.team/members/location-points-by-country').then(setupCountryLocations); }, 1000);
		});

		var memberPoints = null;

		function getCentroid(datum) {
			var geom = {
				"type": "Feature",
				"geometry": {
					"type": "Point",
					"coordinates": [
						datum.longitude,
						datum.latitude
					]
				}
			};

			var point = map.path.centroid(geom);
			point[0] = point[0] - 16;
			point[1] = point[1] - 16;

			return point;
		}

		function setupCountryLocations(data) {
			countryLocations = data;

			for (var ix = 0; ix < countryLocations.length; ++ix) {
				var countryData = countryLocations[ix];
				for (var iy = 0; iy < countryData.length; ++iy) {
					var centroid = getCentroid(countryData[iy]);
					countryData[iy].x = centroid[0];
					countryData[iy].y = centroid[1];
				}
			}

			setInterval(getSelectionFromCountries, 1000);
		}

		function getSelectionFromCountries() {
			var items = [];
			var limit = 3;

			for (var ix = 0; ix < limit; ++ix) {
				items.push(countryLocations[0][0]);
				rotate(countryLocations[0]);
				rotate(countryLocations);
			}

			addPoints(items);
		}

		function addPoints(data) {
			if (memberPoints == null)
				memberPoints = map.svg.selectAll('g.zoom');

			memberPoints.selectAll("circle").data(data).enter().append("use")
				.attr("href", function (d) {
					if (d.gender == "F") return "#pinWomen";
					return "#pinMen";
				})
				.attr("x", function(d) { return d.x })
				.attr("y", function(d) { return d.y })
				.attr("width", "3%")
				.attr("height", "3%").style("opacity", "0")
				.transition()
					.duration(2000)
					.style("opacity", "100")
				.transition()
					.duration(2000)
					.style("opacity", "0")
				.remove();
			
		}

		function rotate(a) {
			a.push(a.shift());
			return a;
		}
	</script>
</html>
